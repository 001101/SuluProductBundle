define(["suluproduct/collections/currencies","suluproduct/models/variant"],function(a,b){"use strict";var c={},d=function(){this.sandbox.sulu.initListToolbarAndList.call(this,"product-variants-list","/admin/api/product-variants/fields",{el:"#list-toolbar",instanceName:c.toolbarInstanceName,small:!1,template:this.sandbox.sulu.buttons.get({add:{options:{id:"add",icon:"plus-circle",callback:l.bind(this)}},"delete":{options:{id:"delete",icon:"trash-o",disabled:!0,callback:h.bind(this)}}})},{el:"#product-variants",actionCallback:i.bind(this),resultKey:"products",searchFields:["name"],url:"/admin/api/products/"+this.options.data.id+"/variants?flat=true&locale="+this.options.locale})},e=function(){this.sandbox.on("sulu.product-variant-overlay.closed",f.bind(this))},f=function(){this.sandbox.stop(this.$overlay)},g=function(){this.sandbox.dom.html(this.$el,this.renderTemplate("/admin/product/template/product/variants")),d.call(this)},h=function(){alert("Please delete an attribute")},i=function(a,b){l.call(this,b)},j=function(){var b=$.Deferred(),c=new a({locale:this.options.locale});return c.fetch({success:function(a){this.currencies=a.toJSON(),b.resolve()}.bind(this),error:function(){console.error("Error while loading currencies"),b.reject()}}),b.promise()},k=function(a,c){var d=b.findOrCreate({id:a.id,productId:this.options.data.id,locale:c});d.save(a,{success:function(){}})},l=function(a){this.currenciesLoaded.then(function(){this.$overlay=this.sandbox.dom.createElement("<div>"),this.sandbox.dom.append(this.$el,this.$overlay),this.sandbox.start([{name:"variant-overlay@suluproduct",options:{el:this.$overlay,data:a,currencies:this.currencies,locale:this.options.locale,parentPrices:this.options.data.attributes.prices,variantAttributes:this.options.data.attributes.variantAttributes,okCallback:k.bind(this)}}])}.bind(this))};return{view:!0,templates:["/admin/product/template/product/variants"],initialize:function(){this.$overlay=null,this.currencies=[],this.currenciesLoaded=j.call(this),g.call(this),e.call(this)}}});