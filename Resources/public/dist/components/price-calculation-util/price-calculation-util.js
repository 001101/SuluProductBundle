define([],function(){"use strict";var a={discount:0,currency:"EUR",taxRate:.2,locale:"en",unit:"pc"},b={invalidInputTranslation:"products.price-calculation.invalid.input"},c=function(a,b){return a.dom.isNumeric(b)?(b=parseFloat(b),!(isNaN(b)||!(b>=0))):!1},d=function(d,e){if(c(d,e))return parseFloat(e)/100;if(e)throw d.logger.error("Invalid argument for tax rtae!",e),new Error(d.translate(b.invalidInputTranslation));return a.taxRate},e=function(a,d){if(!(c(a,d)&&parseFloat(d)<=100)){if(d)throw a.logger.error("Invalid argument for discount!",d),new Error(a.translate(b.invalidInputTranslation));return parseFloat(b.discount)}var e=parseFloat(d)/100;return 1>=e?e:void 0},f=function(a){return"en"!==a},g=function(a,b,d,e,f){return c(a,b)&&c(a,d)&&c(a,e)&&!(parseFloat(e)>100)&&c(a,f)?!0:(a.logger.error("Invalid parameter(s) for price calculation!"),!1)},h=function(a,c){var f,h,i,j,k=0,l={taxes:{},netPrice:0,grossPrice:0};for(f in c){if(!g(a,c[f].price,c[f].tax,c[f].discount,1))throw new Error(a.translate(b.invalidInputTranslation));h=c[f],i=e(a,h.discount),j=parseFloat(h.price),j*=h.quantity,i&&(j-=parseFloat(h.price)*i),l.netPrice+=j,k=l.netPrice*d(a,h.tax),k>0&&(l.taxes[h.tax]?l.taxes[h.tax]+=k:l.taxes[h.tax]=k),l.grossPrice+=j+k}return l};return{getFormattedGrossPrice:function(c,e,h,i){if(!g(c,e,i,0,0))return c.translate(b.invalidInputTranslation);var j,k;return e=parseFloat(e),i=d(c,i),h=h||a.currency,k=c.globalize.getLocale()||a.locale,j=e+e*i,this.getFormattedNumberWithAddition(c,j,h,f(k))},getFormattedNetPrice:function(c,e,h,i){if(!g(c,e,i,0,0))return c.translate(b.invalidInputTranslation);var j,k;return e=parseFloat(e),i=d(c,i),h=h||a.currency,k=c.globalize.getLocale()||a.locale,j=e-e*i,this.getFormattedNumberWithAddition(c,j,h,f(k))},getFormattedAmountAndUnit:function(d,e,f){return c(d,e)?(f=f||a.unit,this.getFormattedNumberWithAddition(d,e,f,!0)):(d.logger.error("Invalid parameter in getFormattedAmountAndUnit!"),d.translate(b.invalidInputTranslation))},getFormattedNumberWithAddition:function(a,b,c,d){var e=a.numberFormat(b,"n");return d?e+" "+c:c+""+e},getTotalPrice:function(c,h,i,j,k,l,m){if(!g(c,h,l,j,k))return c.translate(b.invalidInputTranslation);var n,o;try{h=parseFloat(h),k=parseFloat(k),l=d(c,l),j=e(c,j),i=i||a.currency,o=c.globalize.getLocale()||a.locale}catch(p){return c.translate(b.invalidInputTranslation)}return m||(h-=h*l),n=h*k,n-=n*j,this.getFormattedNumberWithAddition(c,n,i,f(o))},getTotalPricesAndTaxes:function(a,b){if(b)try{return h.call(this,a,b)}catch(c){return null}return null}}});