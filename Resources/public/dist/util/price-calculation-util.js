define([],function(){"use strict";var a={discount:0,currency:"EUR",taxRate:.2,locale:"en",unit:"pc"},b={invalidInputTranslation:"products.price-calculation.invalid.input"},c=function(a,b){return a.dom.isNumeric(b)?(b=parseFloat(b),!(isNaN(b)||!(b>=0))):!1},d=function(b,d){if(c(b,d))return parseFloat(d)/100;if(d)throw new Error("Invalid argument for tax rate ("+d+")!");return a.taxRate},e=function(a,d){if(c(a,d)&&parseFloat(d)<=100)return parseFloat(d)/100;if(d)throw new Error("Invalid argument for discount ("+d+")!");return parseFloat(b.discount)},f=function(b){return b?b:a.currency},g=function(b){return b?b:a.unit},h=function(b){return b?b:a.locale},i=function(a){return"en"!==a},j=function(a,b,d,e,f){return!a.dom.isNumeric(b)||!c(a,d)||parseFloat(d)>100||!c(a,e)||parseFloat(e)>100||!c(a,f)?(a.logger.error("Invalid parameter(s) for price calculation!"),!1):!0},k=function(a,b){var c=e(a,b.discount),d=parseFloat(b.price);return d*=b.quantity,c&&(d-=d*c),d},l=function(a,b,c,d){if(a.dom.isNumeric(c)&&0!=c){var e,f,g,h=0,i=0;for(var l in b){if(!j(a,b[l].price,b[l].tax,b[l].discount,b[l].quantity))return null;e=b[l],f=k(a,e),h=e.tax.toString(),i=0,0!=d.netPrice&&(i=f/d.netPrice),g=i*c*e.tax/100,d.taxes[h]+=g,d.grossPrice+=g}d.netPrice+=c,d.grossPrice+=c}},m=function(a,b,c){var e,f,g,h=0,i={taxes:{},netPrice:0,grossPrice:0};"undefined"==typeof c&&(c=0);try{for(e in b){if(!j(a,b[e].price,b[e].tax,b[e].discount,b[e].quantity))return null;f=b[e],g=k(a,f),h=g*d(a,f.tax),i.taxes[f.tax]?i.taxes[f.tax]+=h:i.taxes[f.tax]=h,i.netPrice+=g,i.grossPrice+=g+h}return l(a,b,c,i),i}catch(m){return a.logger.error(m.message),null}};return{getFormattedGrossPrice:function(a,c,e,g){if(!j(a,c,g,0,0))return a.translate(b.invalidInputTranslation);var k,l;try{return c=parseFloat(c),g=d(a,g),e=f(e),l=h(a.globalize.getLocale()),k=c+c*g,this.getFormattedNumberWithAddition(a,k,e,i(l))}catch(m){return a.logger.error(m.message),a.translate(b.invalidInputTranslation)}},getFormattedNetPrice:function(a,c,e,g){if(!j(a,c,g,0,0))return a.translate(b.invalidInputTranslation);var k,l;return c=parseFloat(c),g=d(a,g),e=f(e),l=h(a.globalize.getLocale()),k=c-c*g,this.getFormattedNumberWithAddition(a,k,e,i(l))},getFormattedAmountAndUnit:function(a,c,d){return a.dom.isNumeric(c)?(d=g(d),this.getFormattedNumberWithAddition(a,c,d,!0)):(a.logger.error("Invalid parameter in getFormattedAmountAndUnit!"),a.translate(b.invalidInputTranslation))},getFormattedNumberWithAddition:function(a,b,c,d){var e=a.numberFormat(b,"n");return d?e+" "+c:c+""+e},getTotalPrice:function(a,c,g,k,l,m,n){if(!j(a,c,m,k,l))return a.translate(b.invalidInputTranslation);var o,p;try{c=parseFloat(c),l=parseFloat(l),m=d(a,m),k=e(a,k),g=f(g),p=h(a.globalize.getLocale())}catch(q){return a.logger.error(q.message),a.translate(b.invalidInputTranslation)}return n||(c-=c*m),o=c*l,o-=o*k,this.getFormattedNumberWithAddition(a,o,g,i(p))},getTotalPricesAndTaxes:function(a,b,c){return b?m.call(this,a,b,c):null},getTotalFormattedPrice:function(a,b,c){var d=0,e=h(a.globalize.getLocale());return a&&b&&a.util.foreach(b,function(b){d+="string"==typeof b?a.parseFloat(b):b}.bind(this)),this.getFormattedNumberWithAddition(a,d,c,i(e))}}});